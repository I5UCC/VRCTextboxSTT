<!DOCTYPE html>
<html>
<head>
    <title>TextboxSTT</title>
</head>
<style>
    div {
        position: absolute;
        bottom: 0px;
        font-family: 'Cascadia Code', Arial, monospace;
        color: white;
        text-shadow:
            1px 1px 2px black,
            1px -1px 2px black,
            -1px 1px 2px black,
            -1px -1px 2px black;
        font-size: 48px;
        font-weight: 700;
        width: 100%;
        text-align: center;
    }
</style>

<body>
    <div id="transcript"></div>
    <script>
        let last_text = "";
        let current_text = "";
        let text = "";
        let finished = true;
        let e_transcript = document.getElementById("transcript");
        let i = 0;
        function typeWriter() {
            
            if (i < text.length) {
                e_transcript.innerHTML += text.charAt(i);
                i++;
                setTimeout(typeWriter, 30);
            }
        }
        function getTranscript() {
            fetch("http://127.0.0.1:5000/transcript")
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    if (data != current_text) {
                        last_text = current_text;
                        current_text = data;
                        
                        if (finished) {
							last_text = ""
                            text = current_text
                            e_transcript.innerHTML = "";
                        }
                        else {
                            e_transcript.innerHTML = current_text.slice(0, last_text.length);
                            text = current_text.slice(last_text.length)
                        }
                        i = 0;
                        typeWriter()
                    }
                })
                .catch(function (err) {
                    console.log('Fetch Error: ', err);
                });
            
            fetch("http://127.0.0.1:5000/finished")
                .then(function (response) {
                    return response.json();
                })
                .then(function (data) {
                    finished = data
                })
                .catch(function (err) {
                    console.log('Fetch Error: ', err);
                });
            window.scrollTo(0, document.body.scrollHeight);
        }
        setInterval(getTranscript, 200);
    </script>
</body>
</html>
